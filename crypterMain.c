// Copyright 2020 (C) Julian Huch
// Autor: Julian Huch

#include "crypter.h"

// Main function.
int main(int argc, char** argv)
{
    // Check if the right arguments got passed to the program.
    if ( !checkArguments(argc, argv) ) { exit(1); }
    
    // Allocate memory for Buffer and Size. Null memory values.
    PARAMS* data = malloc(sizeof(PARAMS));
    memset(data, 0, sizeof(PARAMS));
    
    // Load the executable into the memory buffer.
    if ( !openExecutable(data) )
    {
        fprintf(stdout, "There was an error opening the file.\n");
        exit(1);
    }
    
    // Encrypt the bytes stored in memory buffer.
    encryptExecutable(data);
    
    // Write the encrypted bytes from memory buffer to file.
    if ( !writeExecutable(data) )
    {
        fprintf(stdout, "There was an error writing the encrypted file.\n");
        exit(1);
    }

    // Free memory!
    freeBuffer(data);
    
    // After complete, print out this line.
    fprintf(stdout, "Sucessfully created %10s encrypted file.\n", (*argv)+1);

    return EXIT_SUCCESS;
}

